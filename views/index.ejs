<!DOCTYPE HTML>
<html>

<head>
  <title>VIT RoomSwap</title>
  <link href="styles.css" rel="stylesheet" />
  <link href="roomswap.png" rel="icon">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script>
    document.onreadystatechange = function(e) {
      let body = document.getElementsByTagName("body")[0];
      const theme = window.sessionStorage.getItem("theme");
      if (theme == null) {
        window.sessionStorage.setItem("theme", "light");
      } else {
        body.setAttribute("data-theme", theme);
      }
    };

    window.onload = () => {
      document.getElementById("color-switch").addEventListener("click", () => {
        let body = document.getElementsByTagName("body")[0];
        const theme = window.sessionStorage.getItem("theme");
        if (theme == null) {
          body.setAttribute("data-theme", "light");
          window.sessionStorage.setItem("theme", "light");
        } else {
          body.setAttribute("data-theme", (theme === "dark") ? "light" : "dark");
          window.sessionStorage.setItem("theme", (theme === "dark") ? "light" : "dark");
        }
      })
    }
  </script>
</head>

<body data-theme="light">
  <a href="/" id='logo-link'>
    <h1 id="clip" style="display: flex; flex-direction: column;">
      <img id="logo" alt='RoomSwap logo' src="roomswap.png">
      RoomSwap ùõº
    </h1>
  </a>
  <% if (!user.loggedIn) { %>
  <a href="<%= authLink %>">Login with Google</a>
  <% } else {%>
  <p>Logged in as
    <strong>
      <%= user.name %>
    </strong>
    (<a href="/logout">Logout</a>)
  </p>
  <details id='your-details' <%= user.firstLogin ? 'open' : '' %>>
    <summary><strong>Your details</strong></summary>
    <%if (user.firstLogin) { %>
    <div class='toast'>If you want to be listed on the index, set "Looking to swap" to "Yes".</div>
    <% } %>

    <div class="body-form-wrapper">
      <form class='body-form' method="post" action="/form/swap">
        <div class="form-group">
          <label for="swap"><strong>Looking to swap?</strong></label>
          <input type="checkbox" name="swap" id="swap" <% if (user.swapping) { %> checked <% } %>>
        </div>

        <div class="form-group">
          <label for="room-no"><strong>Room Number</strong></label>
          <input type="number" name="room-no" id="room-no" min="101" required <% if (user.room_no) { %> value="<%= user.room_no %>" <% } %>>
        </div>

        <% if (!user.firstLogin) { %>
        <div class='form-group'>
          <strong>Registration number</strong>
          <span>
            <%= user.regno %>
          </span>
        </div>
        <div class='form-group'>
          <strong>Room size</strong>
          <span>
            <%= user.size %>
          </span>
        </div>
        <div class='form-group'>
          <strong>A/C type</strong>
          <span>
            <%= user.ac ? 'AC' : 'Non-AC' %>
          </span>
        </div>
        <% } %>

        <div class="form-group submit-group">
          <input type="submit" value="Update">
        </div>
      </form>
    </div>
  </details>
  <% if (user.firstLogin) { %>
  <div class="modal-back">
    <div class="card modal-front">
      <p>
        You need to set your <strong>room size</strong> and <strong>AC status</strong> to proceed.
      </p>
      <p>Note: These cannot be changed once set.</p>
      <form action="/form/init" method="post" name="initial-login">

        <div class="form-group">
          <label for="initial-size"><strong>Size</strong></label>
          <select name="initial-size" id="initial-size" required>
            <option value="4">4</option>
            <option value="3">3</option>
            <option value="2">2</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reg-no"><strong>Registration no</strong></label>
          <input type='text' name="reg-no" id='reg-no' required>
        </div>

        <div class="form-group">
          <label for="initial-class"><strong>AC or Non-AC</strong></label>
          <select name="initial-class" id="initial-class" required>
            <option value="AC">AC</option>
            <option value="NAC">NAC</option>
          </select>
        </div>

        <div class="form-group submit-group">
          <input type="submit" value="Submit">
        </div>
      </form>
    </div>
  </div>
  <% } %>
  <% } %>
  <h3>Rooms</h3>
  <details id='#filter-rooms'>
    <summary>Filter</summary>
    <div class="body-form-wrapper">
      <form name="search" class='body-form'>
        <div class="form-group">
          <label for="room_no">Room No:</label>
          <input type="text" name="room_no">
        </div>

        <div class="form-group">
          <label for="block">Block:</label>
          <select name="block">
            <option value="any">any</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
          </select>
        </div>

        <div class="form-group submit-group">
          <input type="submit" value="Refine">
        </div>
      </form>
    </div>
  </details>
  <div class="row">
    <% if (Object.keys(available).length > 0) { %>
    <% for (const [room, users] of Object.entries(available)) { %>
    <div class="card">
      <div class='room-heading'>No. <%= room %></div>
      <div class='room-meta'>
        <div>
          <strong><%= users.length %></strong> swapper(s)
          <ul class='room-occupants'>
            <% for (const user of users) { %>
            <li><%= `${user.name} (${user.reg_no})` %></li>
            <% } %>
          </ul>
        </div>
        <div>
          <strong><%= users[0].size %></strong>-bed, <strong><%= users[0].ac ? 'AC' : 'Non-AC' %></strong>
        </div>
      </div>
    </div>
    <% } %>
    <% } else { %>
    <strong>No rooms available</strong>
    <% } %>
  </div>
  <a id="color-switch">üåó</a>
</body>

</html>